% This is the outer theme file of the NLeSC theme.
%
% Description: An outer theme dictates the overall layout of frames, 
% i.e., specifies where any navigational elements should go (like a mini table of contents or navigational mini frames), 
% and what they should look like. Typically, an outer theme specifies how the following elements are rendered:
% the head- and footline, the sidebars, the logo and the frame title.
% 
% 
% Copyright 2016 @ NLeSC
% 
% Licensed under the Apache License, Version 2.0 (the "License");
% you may not use this file except in compliance with the License.
% You may obtain a copy of the License at
% 
%     http://www.apache.org/licenses/LICENSE-2.0
% 
% Unless required by applicable law or agreed to in writing, software
% distributed under the License is distributed on an "AS IS" BASIS,
% WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
% See the License for the specific language governing permissions and
% limitations under the License.
%
%----------------------------------------------------------------------------------------------------------------------------------

\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{beamerinnerthemeNLeSC}[2016/04/28 v1.0.0 NLeSC Beamer Theme]

%----------------------------------------------------------------------------------------------------------------------------------
% 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Theme-required packages.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


% In essence we want the vertical pitch to be such that there are 30 steps.
% This is based on the PowerPoint template sizes.
%
\newlength{\cam@outer@pitch} \setlength{\cam@outer@pitch}{0.0333333\paperheight} 



\setbeamersize{text margin left=2\cam@outer@pitch}
\setbeamersize{text margin right=2\cam@outer@pitch}

\setbeamerfont{section in head/foot}{size=\Large}
\setbeamerfont{logo in head/foot}{parent=subsection in head/foot}

\setbeamerfont{progress}{size=\tiny,series=\bfseries}
\setbeamercolor{progress}{fg=structure.fg!50}

% The NLeSC logo
\pgfdeclareimage[height=1.2\cam@outer@pitch]{beamerlogoNLeSC}{media/image7.png}



% beamer specific options

               \mode<presentation> % refers to the first four modes (beamer,handout,second and trans). That is, to all modes except the article mode
{

% Mini frames

\defbeamertemplate*{mini frame}{NLeSC theme}
{%
  \begin{pgfpicture}{0pt}{0pt}{0.1cm}{0.1cm}
    \pgfpathcircle{\pgfpoint{0.05cm}{0.05cm}}{0.05cm}
    \pgfusepath{fill,stroke}
  \end{pgfpicture}%
}
[action]
{
  \setbeamersize{mini frame size=.14cm,mini frame offset=.03cm}
}

\defbeamertemplate*{mini frame in current subsection}{NLeSC theme}
{%
  \begin{pgfpicture}{0pt}{0pt}{0.1cm}{0.1cm}
    \pgfpathcircle{\pgfpoint{0.05cm}{0.05cm}}{0.05cm}
    \pgfusepath{stroke}
  \end{pgfpicture}%
}

\defbeamertemplate*{mini frame in other subsection}{NLeSC theme}[1][50]
{\color{fg!#1!bg}\usebeamertemplate{mini frame in current subsection}}

% Navigation symbols
\defbeamertemplate*{navigation symbols}{NLeSC theme}{}

% Section and subsections in head/foot

\defbeamertemplate*{section in head/foot}{NLeSC theme}
{\insertsectionhead}

\defbeamertemplate*{section in head/foot shaded}{NLeSC theme}[1][50]
{\color{fg!#1!bg}\usebeamertemplate{section in head/foot}}

\defbeamertemplate*{subsection in head/foot}{NLeSC theme}
{\insertsubsectionhead}

\defbeamertemplate*{subsection in head/foot shaded}{NLeSC theme}[1][50]
{\color{fg!#1!bg}\usebeamertemplate{subsection in head/foot}}

\defbeamertemplate*{subsubsection in head/foot}{NLeSC theme}
{\insertsubsubsectionhead}

\defbeamertemplate*{subsubsection in head/foot shaded}{NLeSC theme}[1][50]
{\color{fg!#1!bg}\usebeamertemplate{subsubsection in head/foot}}

% background

\defbeamertemplate*{background}{NLeSC theme}
{}

% Headline and footline

\defbeamertemplate*{frametitle}{NLeSC theme}
{%
  \vskip-1pt % HACK: Removes a bright line at the top of the page.
  \begin{beamercolorbox}[wd=\paperwidth,ht=3.5\cam@outer@pitch,dp=\cam@outer@pitch,sep=0pt,center]{palette tertiary}%
    \begin{beamercolorbox}[]{}%%ht=0pt,sep=0pt]{}%
      \usebeamerfont{frametitle}\insertframetitle
    \end{beamercolorbox}
  \end{beamercolorbox}%
  \nointerlineskip
  \begin{beamercolorbox}[wd=\paperwidth,dp=0\cam@outer@pitch]{lower separation line head}%
  \end{beamercolorbox}%
}

\defbeamertemplate*{footprogress}{NLeSC theme}
{%
    \usebeamerfont{progress}\usebeamercolor[NLeSCCoreBlack]{progress}\insertframenumber\ %of \inserttotalframenumber
}

% Frame title continuations, default

\defbeamertemplate*{frametitle continuation}{NLeSC theme}{\insertcontinuationcountroman}

%\defbeamertemplate*{footprogress}{NLeSC theme}
%{%
%\begin{tikzpicture}[x=\cam@outer@pitch,y=\cam@outer@pitch]
%   \draw[step=0.5,gray,very thin] (-1.4,-1.4) grid (1.4,1.4); 
%   \draw (-1.5,0) -- (1.5,0);
%   \draw (0,-1.5) -- (0,1.5);
%   \draw (0,0) circle (1); \draw (0.3,0) arc (0:30:0.3);
%\end{tikzpicture}
%
% % \insertframenumber\ of \inserttotalframenumber
%}

\defbeamertemplate*{footline}{NLeSC theme}
{
  \ifx \insertframetitle \@empty
    % There was no frame title
  \else
    % There was a frame title, typeset the counterpart to the frame title (this is a hack).
    \begin{beamercolorbox}[sep=0.5\cam@outer@pitch,leftskip=1.5\cam@outer@pitch,rightskip=0.5\cam@outer@pitch]{palette secondary}%
      \usebeamerfont{logo in head/foot}\insertlogo
       \hspace{5cm}
      \hbox{\usebeamertemplate{footprogress}}   
    \end{beamercolorbox}%
  \fi
}


% Sidebar

\defbeamertemplate*{sidebar left}{NLeSC theme}
{}

\defbeamertemplate*{sidebar right}{NLeSC theme}
{}

\defbeamertemplate*{sidebar canvas left}{NLeSC theme}
{}

\defbeamertemplate*{sidebar canvas right}{NLeSC theme}
{}

% Notes

\defbeamertemplate*{note page}{NLeSC theme}
{%
  {%
    \scriptsize
    \insertvrule{.25\paperheight}{white!90!black}
    \vskip-.25\paperheight
    \nointerlineskip
    \vbox{
      \hfill\insertslideintonotes{0.25}\hskip-\Gm@rmargin\hskip0pt%
      \vskip-0.25\paperheight%
      \nointerlineskip
      \begin{pgfpicture}{0cm}{0cm}{0cm}{0cm}
        \begin{pgflowlevelscope}{\pgftransformrotate{90}}
          {\pgftransformshift{\pgfpoint{-2cm}{0.2cm}}%
          \pgftext[base,left]{\footnotesize\the\year-\ifnum\month<10\relax0\fi\the\month-\ifnum\day<10\relax0\fi\the\day}}
        \end{pgflowlevelscope}
      \end{pgfpicture}}
    \nointerlineskip
    \vbox to .25\paperheight{\vskip0.5em
      \hbox{\insertshorttitle[width=8cm]}%
      \setbox\beamer@tempbox=\hbox{\insertsection}%
      \hbox{\ifdim\wd\beamer@tempbox>1pt{\hskip4pt\raise3pt\hbox{\vrule
            width0.4pt height7pt\vrule width 9pt
            height0.4pt}}\hskip1pt\hbox{\begin{minipage}[t]{7.5cm}\def\breakhere{}\insertsection\end{minipage}}\fi%
      }%
      \setbox\beamer@tempbox=\hbox{\insertsubsection}%
      \hbox{\ifdim\wd\beamer@tempbox>1pt{\hskip17.4pt\raise3pt\hbox{\vrule
            width0.4pt height7pt\vrule width 9pt
            height0.4pt}}\hskip1pt\hbox{\begin{minipage}[t]{7.5cm}\def\breakhere{}\insertsubsection\end{minipage}}\fi%
      }%
      \setbox\beamer@tempbox=\hbox{\insertshortframetitle}%
      \hbox{\ifdim\wd\beamer@tempbox>1pt{\hskip30.8pt\raise3pt\hbox{\vrule
            width0.4pt height7pt\vrule width 9pt
            height0.4pt}}\hskip1pt\hbox{\insertshortframetitle[width=7cm]}\fi%
      }%
      \vfil}%
  }%
  \vskip.25em
  \nointerlineskip
  \insertnote
}

}

%----------------------------------------------------------------------------------------------------------------------------------

\mode<all>

\ifbeamertemplateempty{logo}{%
   \setbeamertemplate{logo}{%
%   \makebox[\linewidth]{%
  \pgftext[left,bottom]{\pgfuseimage{beamerlogoNLeSC}}%
%       \includegraphics[width=\paperwidth,height=0.5\paperheight]{media/image7}
%       }  
   }
}{%
   % Do nothing if logo is set.
}
